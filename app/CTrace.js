import React, { useState } from 'react';
import { View, Text, ImageBackground, StyleSheet, SafeAreaView, Dimensions, TouchableOpacity } from 'react-native';
import { FontAwesome } from '@expo/vector-icons';
import { Link } from 'expo-router';
import { Canvas, Fill, Mask, Morphology, Path, Skia } from "@shopify/react-native-skia";
import { Gesture, GestureDetector, GestureHandlerRootView } from "react-native-gesture-handler";
import { useSharedValue } from "react-native-reanimated";

const { width, height } = Dimensions.get("window");

const numbers = [
  { number: '1', path: "M 39.2 70 L 4 70 L 4 62 L 18.3 62 L 18.3 11.5 L 4.9 21.6 L 0 14.9 L 20.7 0 L 27.3 0 L 27.3 62 L 39.2 62 L 39.2 70 Z", width: 100, height: 100, viewbox: "-50 -50 200 200" },
  { number: '2', path: "M 40.9 71.2 L 0.3 71.2 Q 0 69.4 0 67.5 A 32.192 32.192 0 0 1 0.635 60.975 A 25.813 25.813 0 0 1 2.25 55.85 Q 4.5 50.7 8.1 46.45 Q 11.7 42.2 15.75 38.55 Q 19.8 34.9 23.35 31.55 A 46.218 46.218 0 0 0 26.769 27.977 A 35.601 35.601 0 0 0 29.2 24.8 Q 31.5 21.4 31.5 17.7 A 9.278 9.278 0 0 0 30.676 13.755 A 9.139 9.139 0 0 0 28.4 10.75 A 10.723 10.723 0 0 0 23.083 8.23 A 15.011 15.011 0 0 0 20.4 8 A 18.533 18.533 0 0 0 15.443 8.645 A 16.281 16.281 0 0 0 12.75 9.65 A 25.364 25.364 0 0 0 6.962 13.502 A 28.825 28.825 0 0 0 6.3 14.1 L 1.3 8 Q 5.3 4.4 10.15 2.2 A 24.132 24.132 0 0 1 16.456 0.363 A 32.297 32.297 0 0 1 21.4 0 A 26.13 26.13 0 0 1 26.602 0.495 A 19.778 19.778 0 0 1 31.7 2.25 A 17.784 17.784 0 0 1 36.587 5.862 A 16.365 16.365 0 0 1 38.55 8.4 Q 41 12.3 41 17.1 Q 41 21.9 38.9 26 A 34.778 34.778 0 0 1 33.908 33.248 A 38.693 38.693 0 0 1 33.5 33.7 Q 30.2 37.3 26.4 40.65 Q 22.6 44 19.1 47.5 A 45.932 45.932 0 0 0 14.526 52.803 A 40.289 40.289 0 0 0 13.15 54.8 Q 10.7 58.6 10.1 63 L 40.9 63 L 40.9 71.2 ", width: 100, height: 100, viewbox: "-50 -50 200 200" },
  { number: '3', path: "M 0 66.4 L 4.1 58.9 A 29.424 29.424 0 0 0 7.952 61.33 A 36.526 36.526 0 0 0 10.6 62.6 A 18.21 18.21 0 0 0 14.42 63.749 Q 16.267 64.102 18.39 64.179 A 33.313 33.313 0 0 0 19.6 64.2 Q 26.2 64.2 30.05 60.7 A 11.476 11.476 0 0 0 33.24 56.015 A 11.929 11.929 0 0 0 33.9 52 Q 33.9 48.3 31.9 45.25 Q 29.955 42.284 25.975 40.405 A 21.187 21.187 0 0 0 25.75 40.3 Q 22.543 38.832 17.874 38.499 A 40.356 40.356 0 0 0 15 38.4 L 9.4 38.4 L 9.4 31.1 L 14.6 31.1 A 31.908 31.908 0 0 0 18.656 30.858 Q 21.914 30.439 24.35 29.3 A 16.484 16.484 0 0 0 27.251 27.586 A 11.823 11.823 0 0 0 30.1 24.6 Q 32 21.7 32 18.5 A 10.072 10.072 0 0 0 31.271 14.611 A 9.418 9.418 0 0 0 28.45 10.9 A 12.755 12.755 0 0 0 21.896 8.139 A 16.888 16.888 0 0 0 19.7 8 Q 15 8 11.35 9.55 Q 7.7 11.1 5.4 13 L 1.7 5.9 A 32.63 32.63 0 0 1 4.189 4.407 Q 5.61 3.633 7.29 2.867 A 66.563 66.563 0 0 1 9.4 1.95 A 24.597 24.597 0 0 1 14.845 0.429 Q 17.447 0 20.4 0 Q 26.384 0 30.724 1.973 A 17.976 17.976 0 0 1 31.6 2.4 A 19.376 19.376 0 0 1 35.881 5.388 A 16.398 16.398 0 0 1 38.65 8.75 Q 41.1 12.7 41.1 17.3 A 19.531 19.531 0 0 1 40.575 21.94 A 14.587 14.587 0 0 1 38.15 27.2 A 19.553 19.553 0 0 1 33.783 31.457 A 26.455 26.455 0 0 1 29.8 33.8 A 24.812 24.812 0 0 1 35.258 36.653 A 19.796 19.796 0 0 1 39.65 40.85 A 17.3 17.3 0 0 1 43.197 51.314 A 21.406 21.406 0 0 1 43.2 51.7 Q 43.2 56.9 40.65 61.65 A 18.802 18.802 0 0 1 35.018 68.004 A 23.697 23.697 0 0 1 32.85 69.4 Q 28.341 71.977 21.729 72.341 A 40.608 40.608 0 0 1 19.5 72.4 A 40.712 40.712 0 0 1 14.138 72.065 Q 10.9 71.635 8.2 70.65 Q 3.4 68.9 0 66.4 Z", width: 100, height: 100, viewbox: "-50 -50 200 200" },
  { number: '4', path: "M 38.9 70.7 L 29.9 70.7 L 29.9 55.8 L 0 55.8 L 0 48.6 L 20.9 0 L 28.7 3.3 L 9.8 47.6 L 29.9 47.6 L 29.9 27.7 L 38.9 27.7 L 38.9 47.6 L 47.2 47.6 L 47.2 55.8 L 38.9 55.8 L 38.9 70.7 ", width: 100, height: 100, viewbox: "-50 -50 200 200" },
  { number: '5', path: "M 0 66 L 4.7 58.3 A 28.895 28.895 0 0 0 10.477 61.479 A 32.164 32.164 0 0 0 10.9 61.65 Q 14.3 63 18.6 63 A 18.948 18.948 0 0 0 23.349 62.436 A 13.678 13.678 0 0 0 29.4 59.15 A 12.805 12.805 0 0 0 33.491 49.861 A 17.128 17.128 0 0 0 33.5 49.3 A 14.735 14.735 0 0 0 32.657 44.224 A 12.876 12.876 0 0 0 29.25 39.15 A 13.782 13.782 0 0 0 23.801 36.097 Q 20.865 35.2 17.1 35.2 L 4.7 35.2 L 4.7 0 L 39.3 0 L 39.3 8.1 L 13.2 8.1 L 13.2 27.1 L 18.2 27.1 A 37.701 37.701 0 0 1 24.381 27.581 Q 27.846 28.157 30.736 29.424 A 22.674 22.674 0 0 1 31.55 29.8 A 21.393 21.393 0 0 1 36.971 33.502 A 18.764 18.764 0 0 1 40.05 37.3 A 20.024 20.024 0 0 1 42.921 46.303 A 24.706 24.706 0 0 1 43 48.3 A 25.044 25.044 0 0 1 42.139 54.981 A 21.101 21.101 0 0 1 39.95 60.15 Q 36.9 65.3 31.4 68.25 A 24.425 24.425 0 0 1 23.783 70.785 A 32.353 32.353 0 0 1 18.5 71.2 A 46.433 46.433 0 0 1 13.824 70.977 Q 10.613 70.652 8 69.85 Q 3.6 68.5 0 66 Z", width: 100, height: 100, viewbox: "-50 -50 200 200" },
  { number: '6', path: "M 39.7 0.2 L 39.7 8.4 Q 38.9 8.3 37.9 8.25 A 40.076 40.076 0 0 0 36.573 8.205 A 34.119 34.119 0 0 0 36 8.2 A 29.284 29.284 0 0 0 27.489 9.384 A 23.482 23.482 0 0 0 18.05 14.85 A 26.884 26.884 0 0 0 11.144 25.71 A 37.941 37.941 0 0 0 9.4 33.1 Q 12.023 30.572 16.048 28.438 A 42.254 42.254 0 0 1 16.6 28.15 A 20.497 20.497 0 0 1 23.545 26.078 A 25.578 25.578 0 0 1 26.6 25.9 A 20.631 20.631 0 0 1 32.674 26.769 A 18.128 18.128 0 0 1 36.6 28.5 Q 41 31.1 43.55 35.75 Q 46.1 40.4 46.1 46.8 A 30.622 30.622 0 0 1 45.366 53.65 A 24.26 24.26 0 0 1 43.15 59.65 A 22.279 22.279 0 0 1 37.229 66.827 A 21.642 21.642 0 0 1 35.1 68.3 A 21.377 21.377 0 0 1 25.823 71.291 A 26.436 26.436 0 0 1 23.4 71.4 Q 17.1 71.4 11.75 68.25 A 20.258 20.258 0 0 1 5.532 62.46 A 27.251 27.251 0 0 1 3.2 58.5 A 29.191 29.191 0 0 1 1.013 52.055 Q 0.317 48.911 0.099 45.243 A 58.177 58.177 0 0 1 0 41.8 A 57.323 57.323 0 0 1 1.374 29.099 A 51.807 51.807 0 0 1 2.25 25.75 A 40.567 40.567 0 0 1 7.361 14.733 A 37.643 37.643 0 0 1 9.05 12.4 Q 13.6 6.6 20.3 3.3 Q 27 0 35.9 0 Q 36.8 0 37.85 0.05 A 30.488 30.488 0 0 1 38.721 0.104 Q 39.118 0.134 39.471 0.173 A 17.166 17.166 0 0 1 39.7 0.2 Z M 9.2 41.1 L 9.2 43.3 Q 9.4 52.7 13.55 57.95 A 14.986 14.986 0 0 0 17.014 61.2 A 12.026 12.026 0 0 0 23.8 63.2 A 13.23 13.23 0 0 0 28.523 62.388 A 11.758 11.758 0 0 0 33.45 58.8 A 15.717 15.717 0 0 0 36.926 50.644 A 20.926 20.926 0 0 0 37.1 47.9 A 19.676 19.676 0 0 0 36.608 43.377 A 13.684 13.684 0 0 0 33.6 37.4 A 11.516 11.516 0 0 0 25.368 33.435 A 15.928 15.928 0 0 0 24.3 33.4 Q 20 33.4 16.1 35.5 Q 12.2 37.6 9.2 41.1 Z", width: 100, height: 100, viewbox: "-50 -50 200 200" },
  { number: '7', path: "M 20.3 70 L 10.2 70 A 147.157 147.157 0 0 1 10.497 60.426 Q 10.878 54.584 11.75 49.55 A 85.784 85.784 0 0 1 13.937 40.035 A 67.979 67.979 0 0 1 16.25 33.4 Q 19.2 26.2 23.6 20.1 A 100.624 100.624 0 0 1 31.608 10.386 A 113.526 113.526 0 0 1 33.7 8.2 L 0 8.2 L 0 0 L 44.4 0 L 44.4 7.2 Q 37.5 13.9 32.9 20.25 Q 28.3 26.6 25.5 33.65 A 60.778 60.778 0 0 0 22.856 42.151 A 77.888 77.888 0 0 0 21.5 49.55 A 123.029 123.029 0 0 0 20.68 57.82 Q 20.395 62.061 20.324 66.792 A 213.244 213.244 0 0 0 20.3 70 Z", width: 100, height: 100, viewbox: "-50 -50 200 200" },
  { number: '8', path: "M 14.3 35 L 14.3 34.6 A 15.488 15.488 0 0 1 9.28 32.372 A 13.985 13.985 0 0 1 5.75 28.85 A 16.656 16.656 0 0 1 2.969 21.819 A 22.222 22.222 0 0 1 2.7 18.3 Q 2.7 13 5.05 8.85 A 15.26 15.26 0 0 1 10.181 3.508 A 19.631 19.631 0 0 1 12.25 2.35 Q 16.354 0.362 22.213 0.056 A 41.972 41.972 0 0 1 24.4 0 A 37.403 37.403 0 0 1 29.524 0.331 Q 32.133 0.692 34.322 1.449 A 19.257 19.257 0 0 1 36.5 2.35 Q 41.3 4.7 43.65 8.85 Q 45.904 12.831 45.904 17.87 A 22.833 22.833 0 0 1 45.9 18.3 Q 45.8 24.4 42.8 28.8 A 13.997 13.997 0 0 1 34.81 34.462 A 17.909 17.909 0 0 1 34.3 34.6 L 34.3 35 Q 38.5 35.7 41.8 38.2 Q 45.1 40.7 46.95 44.6 A 19.192 19.192 0 0 1 48.654 50.723 A 23.907 23.907 0 0 1 48.8 53.4 A 23.863 23.863 0 0 1 48.311 58.352 A 17.423 17.423 0 0 1 46.2 63.8 A 15.394 15.394 0 0 1 41.16 68.858 A 20.621 20.621 0 0 1 38.2 70.4 A 25.703 25.703 0 0 1 33.318 71.89 Q 30.861 72.396 27.992 72.586 A 54.4 54.4 0 0 1 24.4 72.7 A 50.181 50.181 0 0 1 17.798 72.297 Q 10.055 71.266 5.85 67.6 A 16.683 16.683 0 0 1 0.322 57.446 A 24.415 24.415 0 0 1 0 53.4 A 24.768 24.768 0 0 1 0.603 48.34 A 20.159 20.159 0 0 1 1.85 44.6 Q 3.6 40.7 6.85 38.2 Q 10.1 35.7 14.3 35 Z M 24.4 67.5 A 36.714 36.714 0 0 0 29.397 67.184 Q 31.964 66.83 34.028 66.081 A 13.665 13.665 0 0 0 38.5 63.5 Q 43 59.5 43 52.6 A 15.518 15.518 0 0 0 42.238 47.626 A 12.78 12.78 0 0 0 38.2 41.8 A 15.656 15.656 0 0 0 32.883 38.963 Q 29.252 37.8 24.4 37.8 A 33.127 33.127 0 0 0 19.168 38.186 Q 16.496 38.614 14.342 39.518 A 14.611 14.611 0 0 0 10.55 41.8 Q 5.8 45.8 5.8 52.6 A 17.047 17.047 0 0 0 6.433 57.368 A 12.83 12.83 0 0 0 10.3 63.5 A 13.677 13.677 0 0 0 14.792 66.088 Q 18.696 67.5 24.4 67.5 Z M 24.4 32.6 A 26.633 26.633 0 0 0 28.909 32.244 Q 31.33 31.827 33.25 30.924 A 12.21 12.21 0 0 0 36.25 28.95 A 12.023 12.023 0 0 0 40.12 21.54 A 17.251 17.251 0 0 0 40.3 19 A 16.706 16.706 0 0 0 39.768 14.664 A 11.98 11.98 0 0 0 36.35 8.9 A 12.286 12.286 0 0 0 31.939 6.307 Q 30.06 5.65 27.755 5.383 A 29.211 29.211 0 0 0 24.4 5.2 A 28.161 28.161 0 0 0 19.988 5.522 Q 15.15 6.292 12.4 8.9 A 12.228 12.228 0 0 0 8.792 15.702 A 17.809 17.809 0 0 0 8.5 19 A 15.974 15.974 0 0 0 9.057 23.332 A 11.754 11.754 0 0 0 12.5 28.95 Q 15.675 31.847 21.306 32.445 A 29.345 29.345 0 0 0 24.4 32.6 Z", width: 100, height: 100, viewbox: "-50 -50 200 200" },
  { number: '9', path: "M 1.101 64.6 L 7.001 57.9 A 22.787 22.787 0 0 0 11.685 61.732 A 16.566 16.566 0 0 0 20.401 64.2 Q 24.501 64.2 28.001 61.45 A 14.208 14.208 0 0 0 30.85 58.376 Q 31.905 56.865 32.782 54.936 A 29.986 29.986 0 0 0 33.651 52.8 A 31.001 31.001 0 0 0 34.961 47.897 Q 35.801 43.413 35.801 37.6 Q 32.701 40.4 28.901 42.3 Q 25.101 44.2 20.701 44.2 Q 15.401 44.2 10.651 41.75 Q 5.901 39.3 2.951 34.55 Q 0.081 29.93 0.003 23.181 A 32.787 32.787 0 0 1 0.001 22.8 A 24.091 24.091 0 0 1 1.571 14.055 A 22.792 22.792 0 0 1 2.851 11.3 Q 5.701 6.1 10.801 3.05 A 21.482 21.482 0 0 1 19.351 0.191 A 27.036 27.036 0 0 1 22.601 0 A 28.398 28.398 0 0 1 26.578 0.264 Q 28.75 0.572 30.586 1.238 A 16.303 16.303 0 0 1 31.501 1.6 Q 35.201 3.2 37.701 5.8 A 22.776 22.776 0 0 1 41.313 10.801 A 26.029 26.029 0 0 1 41.751 11.65 Q 43.401 15 44.201 20.45 A 63.367 63.367 0 0 1 44.656 24.581 Q 45.001 28.891 45.001 34.6 Q 45.001 47.9 41.701 56.25 A 34.561 34.561 0 0 1 38.912 61.861 Q 36.293 66.055 32.751 68.5 Q 27.101 72.4 19.901 72.4 A 28.172 28.172 0 0 1 14.077 71.822 A 22.735 22.735 0 0 1 9.501 70.35 Q 4.901 68.3 1.101 64.6 Z M 35.801 30.3 L 35.801 27.3 A 39.751 39.751 0 0 0 35.479 22.065 Q 35.122 19.384 34.368 17.203 A 15.762 15.762 0 0 0 32.151 12.9 A 12.066 12.066 0 0 0 28.017 9.303 Q 25.665 8.087 22.722 8.006 A 15.366 15.366 0 0 0 22.301 8 Q 16.601 8 12.651 11.95 A 13.262 13.262 0 0 0 8.925 19.447 A 18.712 18.712 0 0 0 8.701 22.4 A 17.953 17.953 0 0 0 9.064 26.098 A 13.451 13.451 0 0 0 10.601 30.15 Q 12.501 33.4 15.551 35.1 Q 18.601 36.8 22.201 36.8 A 15.326 15.326 0 0 0 29.322 35.021 A 17.939 17.939 0 0 0 29.551 34.9 A 26.394 26.394 0 0 0 35.716 30.384 A 25.001 25.001 0 0 0 35.801 30.3 Z", width: 100, height: 100, viewbox: "-50 -50 200 200" },
  { number: '10', path: "M 39.2 71.202 L 4 71.202 L 4 63.202 L 18.3 63.202 L 18.3 12.702 L 4.9 22.802 L 0 16.102 L 20.7 1.202 L 27.3 1.202 L 27.3 63.202 L 39.2 63.202 L 39.2 71.202 Z M 79.5 72.402 Q 67.8 72.402 61.7 62.852 Q 57.195 55.799 56.017 44.574 A 81.32 81.32 0 0 1 55.6 36.102 A 77.106 77.106 0 0 1 56.21 26.061 Q 57.553 15.864 61.85 9.402 A 20.992 20.992 0 0 1 68.613 2.813 Q 73.356 0.002 79.7 0.002 A 22.809 22.809 0 0 1 87.687 1.338 Q 93.395 3.456 97.122 8.931 A 25.382 25.382 0 0 1 97.5 9.502 Q 101.987 16.49 103.174 27.7 A 81.891 81.891 0 0 1 103.6 36.302 A 77.106 77.106 0 0 1 102.99 46.343 Q 101.647 56.539 97.35 63.002 A 20.992 20.992 0 0 1 90.587 69.591 Q 85.844 72.402 79.5 72.402 Z M 79.6 64.202 A 12.762 12.762 0 0 0 84.021 63.457 A 11.493 11.493 0 0 0 87.35 61.552 A 11.747 11.747 0 0 0 89.743 58.829 Q 91.311 56.424 92.35 52.802 Q 94.096 46.718 94.1 36.455 A 120.37 120.37 0 0 0 94.1 36.402 A 79.493 79.493 0 0 0 93.761 28.79 Q 93.028 21.196 90.711 16.317 A 21.455 21.455 0 0 0 90.25 15.402 A 17.262 17.262 0 0 0 87.778 11.841 A 10.682 10.682 0 0 0 79.6 8.202 A 12.762 12.762 0 0 0 75.179 8.947 A 11.493 11.493 0 0 0 71.85 10.852 Q 68.6 13.502 66.85 19.552 A 36.612 36.612 0 0 0 65.872 24.108 Q 65.1 29.096 65.1 36.002 A 79.493 79.493 0 0 0 65.439 43.614 Q 66.172 51.208 68.489 56.087 A 21.455 21.455 0 0 0 68.95 57.002 A 17.262 17.262 0 0 0 71.422 60.563 A 10.682 10.682 0 0 0 79.6 64.202 Z", width: 100, height: 100, viewbox: "-50 -50 200 200" },
];

export default function NumberTracing() {
  const [currentIndex, setCurrentIndex] = useState(0);
  const number = numbers[currentIndex];
  const drawPath = useSharedValue(Skia.Path.Make());

  const clearTracing = () => {
    drawPath.value = Skia.Path.Make();
    drawPath.modify();
  };

  const changeNumber = (direction) => {
    clearTracing();
    setCurrentIndex((prevIndex) => {
      let newIndex = prevIndex + direction;
      if (newIndex < 0) newIndex = numbers.length - 1;
      if (newIndex >= numbers.length) newIndex = 0;
      return newIndex;
    });
  };

  const gesture = Gesture.Pan()
    .onBegin((event) => {
      drawPath.value.moveTo(event.x, event.y);
      drawPath.modify();
    })
    .onChange((event) => {
      drawPath.value.lineTo(event.x, event.y);
      drawPath.modify();
    })
    .onEnd(() => {
      drawPath.modify();
    });

  return (
    <ImageBackground source={require('../assets/images/mou.jpg')} style={styles.background}>
      <SafeAreaView style={styles.container}>
        <Link href="/StartScreen" style={styles.homeButton}>
          <FontAwesome name="home" size={24} color="white" />
        </Link>
        <Link href="/counting" style={styles.backButton}>
          <FontAwesome name="arrow-left" size={24} color="white" />
        </Link>
        <Text style={styles.title}>Trace the Number</Text>

        <GestureHandlerRootView style={styles.tracingContainer}>
          <GestureDetector gesture={gesture}>
            <Canvas style={styles.canvas}>
              <Fill color="#F7F7F7" />
              <Path path={number.path} transform={[{ scale: 1.5 }, { translateX: 75 }, { translateY: 70 }]} color="black" strokeWidth={8}>
                <Morphology radius={4} />
              </Path>
              <Path path={number.path} transform={[{ scale: 1.5 }, { translateX: 75 }, { translateY: 70 }]} color="white" strokeWidth={6}>
                <Morphology radius={2} />
              </Path>
              <Mask mask={<Path path={drawPath} color="black" strokeWidth={60} style="stroke" />}> 
                <Path path={number.path} transform={[{ scale: 1.5 }, { translateX: 75 }, { translateY: 70 }]} color="blue" strokeWidth={4} />
              </Mask>
            </Canvas>
          </GestureDetector>
        </GestureHandlerRootView>

        <View style={styles.buttonContainer}>
          <TouchableOpacity onPress={() => changeNumber(-1)} style={styles.button}>
            <FontAwesome name="arrow-left" size={24} color="white" />
          </TouchableOpacity>
          <TouchableOpacity onPress={() => changeNumber(1)} style={styles.button}>
            <FontAwesome name="arrow-right" size={24} color="white" />
          </TouchableOpacity>
        </View>
      </SafeAreaView>
    </ImageBackground>
  );
}

const styles = StyleSheet.create({
  background: { flex: 1, resizeMode: 'cover' },
  container: { flex: 1, alignItems: 'center', justifyContent: 'center' },
  homeButton: { position: 'absolute', top: 20, right: 20 },
  backButton: { position: 'absolute', top: 20, left: 20 },
  title: { fontSize: 24, fontWeight: 'bold', color: 'white', marginBottom: 20 },
  tracingContainer: { width: width * 0.8, height: height * 0.5, backgroundColor: '#FFF', borderRadius: 20, justifyContent: 'center', alignItems: 'center' },
  canvas: { width: 300, height: 270 },
  buttonContainer: { flexDirection: 'row', marginTop: 20 },
  button: { marginHorizontal: 20, padding: 10, backgroundColor: '#007AFF', borderRadius: 10 },
});